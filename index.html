<html>
	<head>
		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.0.min.js"></script>

		<style type="text/css">
			.boss-ada-ra {
				text-shadow: 1px 1px 1px #FFD700;
			}
		</style>
	</head>

	<body>
		<div class="container">
			<h1>GGJGame 2015</h1>

			<div class="row">
				<div class="col-md-4">
					<h2>Quest Log</h2>
					<div id="partList">
						<div id="area1_bossBattle">
							<div id="area1_prologe">
								<h2>Prologue</h2>
								After the end of your long quest you reach your final goal. <em class="boss-ada-ra">Ada-Ra, King of Elements</em> reaches out to touch your sword to your weapon but you don't have one equipped, <strong>equip one from your inventory on the side to continue</strong>...
							</div>
						</div>
					</div>
				</div>
				<div class="col-md-4">
					<h2>Current Events</h2>
					<div id="currentEvents">
					</div>
				</div>
				<div class="col-md-4">
					<div id="inventory">
						<h2>Inventory</h2>
						<div id="inventory_primary_weapon">
							<h3>Primary Weapon</h3>
							<ul class="nav nav-pills nav-stacked">

							</ul>
						</div>
						<div id="inventory_head">
							<h3>Head</h3>
							<ul class="nav nav-pills nav-stacked">

							</ul>
						</div>
						<div id="inventory_chestplate">
							<h3>Chest-plate</h3>
							<ul class="nav nav-pills nav-stacked">

							</ul>
						</div>
						<div id="inventory_gloves">
							<h3>Gloves</h3>
							<ul class="nav nav-pills nav-stacked">

							</ul>
						</div>
						<div id="inventory_boots">
							<h3>Boots</h3>
							<ul class="nav nav-pills nav-stacked">

							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script type="text/javascript">
		$(document).ready(function () {
			function log(s) {
				console.log(Array.prototype.join.call(arguments, ", "));
			}

			function appendElements(ele, child) {
				if (typeof child == "string") {
					ele.textContent = child;
				} else if (typeof child == "object" && child instanceof Array) {
					child.forEach(function (subChild) {
						appendElements(ele, subChild);
					});
				} else if (child instanceof HTMLElement) {
					ele.appendChild(child);
				} else {
					ele.textContent = child.toString();
				}
			}

			function e(type, attrs, body) {
				var ele = document.createElement(type);
				for (var key in attrs) {
					ele.setAttribute(key, attrs[key]);
				}
				appendElements(ele, body);
				return ele;
			}

			var inventoryItems = {};

			function item_register(itemName, displayName, stats, events) {
				inventoryItems[itemName] = {
					name: itemName,
					displayName: displayName,
					stats: stats,
					events: events
				}
			}

			function item_emit(itemName, eventName, args) {
				if (inventoryItems[itemName] === undefined) {
					throw new Error("Item does not exist: " + str);
				}
				if (inventoryItems[itemName].events[eventName] !== undefined) {
					return inventoryItems[itemName].events[eventName].apply(inventoryItems[itemName], args);
				} else {
					return null;
				}
			}

			function item_get(itemName) {
				if (inventoryItems[itemName] === undefined) {
					throw new Error("Item does not exist: " + str);
				} else {
					return inventoryItems[itemName];
				}
			}

			function weapon_makeStats(minAttack, maxAttack, type) {
				return {
					minAttack: minAttack,
					maxAttack: maxAttack,
					type: type,
					slot: "primary_weapon"
				};
			}

			item_register("area1_sword", "Dave's Greatsword", weapon_makeStats(100, 500, "largeMelee"), area1_getItemEvents());
			item_register("area1_staff", "Flaming Hairy Staff", weapon_makeStats(50, 100, "magicRanged"), area1_getItemEvents());
			item_register("area1_bow", "Last Good Bow", weapon_makeStats(10, 200, "archerRanged"), area1_getItemEvents());
			item_register("area1_dagger", "Shard of Broken Time", weapon_makeStats(100, 500, "smallMelee"), area1_getItemEvents());

			var charactor = {
				equipped: {},
				inventory: {},
				spells: []
			};

			function char_itemEquiped(itemName) {
				return charactor.equipped[item_get(itemName).stats.slot] == itemName;
			}

			function char_renderInventroy() {
				log("Rendering Inventory");
				$("#inventory_primary_weapon>ul").empty();
				$("#inventory_head>ul").empty();
				$("#inventory_chestplate>ul").empty();
				$("#inventory_gloves>ul").empty();
				$("#inventory_boots>ul").empty();

				for (var item in charactor.inventory) {
					var entryData = charactor.inventory[item];
					var itemData = item_get(item);
					if ($("#inventory_" + itemData.stats.slot + ">ul").length > 0) {
						var ele = null;
						if (char_itemEquiped(item)) {
							ele = e("li", {"class": "active"}, e("a", {}, itemData.displayName));
						} else {
							ele = e("li", {}, e("a", {}, itemData.displayName));
						}
						$(ele).children("a").click(function (e) {
							e.preventDefault();
							char_equipItem(itemData.name);
						});
						$("#inventory_" + itemData.stats.slot + ">ul").append(ele);
					} else {
						throw new Error("Bad Slot: " + itemData.stats.slot)
					}
				}
			}

			function char_equipItem(itemName) {
				charactor[equipped]
				item_emit(str, "equip", []);
				char_renderInventroy();
			}

			function char_addToInventory(str) {
				if (inventoryItems[str] === undefined) {
					throw new Error("Item does not exist: " + str);
				}

				if (charactor.inventory[str] === undefined) {
					charactor.inventory[str] = {
						count: 0
					};
				}

				charactor.inventory[str].count++;

				item_emit(str, "add", []);
			}

			// Hide inital items
			$("#partList").children().each(function (i, element) {
				$(element).hide();
			});

			$("#inventory").hide();
			$("#inventory_primary_weapon").hide();
			$("#inventory_head").hide();
			$("#inventory_chestplate").hide();
			$("#inventory_gloves").hide();
			$("#inventory_boots").hide();

			// area1_bossBattle part1 pre-battle
			setTimeout(function () {
				$("#area1_bossBattle").show();

				setTimeout(function () {
					$("#inventory").show();
					$("#inventory_primary_weapon").show();
					setTimeout(function () {
						char_addToInventory("area1_sword");
						char_addToInventory("area1_staff");
						char_addToInventory("area1_bow");
						char_addToInventory("area1_dagger");
						char_renderInventroy();
					}, 1000);
				}, 1500);
			}, 500);

			function area1_getItemEvents() {
				return {
					"equip": function () {
						area1_equipedItem();
					},
					"swing": function () {
						area1_swingItem(this.name);
					}
				};
			}
		});
		</script>
	</body>
</html>